<!DOCTYPE html>
<html>
<head>
  <style>
    /* CSS styles */

    body {
      margin-top: 20px; 
    }

    #test {
      position: relative;
      width: 500px;
      height: 50px;
      font-size: 20px;
      padding: 10px 60px 10px 10px;
      border-radius: 25px;
      border: 2px solid #ccc;
    }

    #test input[type="search"] {
      width: 100%;
      height: 100%;
      padding: 0;
      border: none;
      outline: none;
      background: transparent;
    }

    #test .mic-icon,
    #test .scanner-icon {
      position: absolute;
      top: 50%;
      transform: translateY(-50%);
      cursor: pointer;
    }

    #test .mic-icon {
      right: 38px;
      background-image: url('/static/mic.png');
      width: 24px;
      height: 24px;
      background-repeat: no-repeat;
      background-size: 100% 100%;
    }

    #test .scanner-icon {
      right: 10px;
      background-image: url('/static/scannerr.png');
      width: 24px;
      height: 24px;
      background-repeat: no-repeat;
      background-size: 100% 100%;
    }

    #test::-webkit-search-cancel-button,
    #test::-webkit-search-decoration,
    #test::-webkit-search-results-button,
    #test::-webkit-search-results-decoration {
      display: none; 
    }

    .search-bar-container {
      position: relative; 
      display: inline-block; 
    }
     input[type="submit"] {
      font-size: 24px;
      padding: 12px 24px;
      border-radius: 25px;
      border: 2px solid #ccc;
      background-color: black;
      color: white;
      cursor: pointer;
    }

    .search-button-container {
      display: inline-block;
      margin-left: 5px;
      vertical-align: top; /* Adjust vertical alignment */
    }

     #saveButton {
      font-size: 24px;
      padding: 12px 24px;
      border-radius: 25px;
      border: 2px solid #ccc;
      background-color: blue;
      color: white;
      cursor: pointer;
    }

    #loginButton {
      font-size: 24px;
      padding: 12px 24px;
      border-radius: 25px;
      border: 2px solid #ccc;
      background-color: green;
      color: white;
      cursor: pointer;
    }

    #tags {
      margin-top: 10px;
    }

    .tag {
      display: inline-block;
      padding: 5px 10px;
      margin-right: 10px;
      background-color: black;
      border-radius: 25px;
      font-size: 16px;
      color: white;
      cursor: pointer;
    }
  </style>
</head>
<body>
 <form id="searchform" class="search2" method="post" action="/save_search">
    <div class="search-bar-container">
      <div id="test">
        <input class="search2" type="search" name="search" size="30" maxlength="255">
        <div class="mic-icon"></div>
        <div class="scanner-icon"></div>
      </div>
    </div>
    <div class="search-button-container">
      <input type="submit" value="Search">
    </div>
    <div class="search-button-container">
      <button id="saveButton">Save</button>
      <button type="button" id="loginButton">Login</button>
    </div>

    <input type="hidden" id="queryInput" name="query">
    <input type="hidden" id="resultsInput" name="results">
  </form>

  <div id="tags">
    <!-- Tags will be dynamically populated here -->
  </div>

  <div id="searchResults"></div>

  <script>
    /* To fetch from Text file */
    function searchFromFile(query) {
      fetch("/static/Search.txt")
        .then(function(response) {
          return response.text();
        })
        .then(function(data) {
          var results = processData(data, query);
          displayResults(results);
        })
        .catch(function(error) {
          console.log("Error fetching data:", error);
        });
    }

    function processData(data, query) {
      var lines = data.split("\n");
      var results = [];

      for (var i = 0; i < lines.length; i++) {
        var line = lines[i].trim();
        var parts = line.split(" ? ");

        var prompt = parts[0];
        var response = parts[1];

        if (prompt.toLowerCase() === query.toLowerCase()) {
          results.push(response);
        }
      }

      return results;
    }

    /* To display results */
    function displayResults(results) {
      var resultsContainer = document.getElementById("searchResults");
      resultsContainer.innerHTML = "";

      if (results.length > 0) {
        for (var i = 0; i < results.length; i++) {
          resultsContainer.innerHTML += "<p>" + results[i] + "</p>";
        }
      } else {
        resultsContainer.innerHTML = "No results found.";
      }
    }

    document.getElementById("searchform").addEventListener("submit", function(event) {
      event.preventDefault();
      var query = document.getElementById("test").getElementsByTagName("input")[0].value;
      searchFromFile(query);
    });

    function handleMicClick() {
      // Prompt the user to speak
      var recognition = new (window.SpeechRecognition || window.webkitSpeechRecognition || window.mozSpeechRecognition || window.msSpeechRecognition)();
      recognition.lang = "en-US";
      recognition.interimResults = false;
      recognition.maxAlternatives = 1;

      recognition.start();

      recognition.onresult = function(event) {
        var query = event.results[0][0].transcript;
        document.getElementById("test").getElementsByTagName("input")[0].value = query;
        searchFromFile(query);
      };
    }

    function handleScannerClick() {
      alert("Scanning...");
    }

    document.querySelector(".mic-icon").addEventListener("click", function() {
      handleMicClick();
    });

    document.querySelector(".scanner-icon").addEventListener("click", function() {
      handleScannerClick();
    });

    document.getElementById("saveButton").addEventListener("click", function() {
      save();
    });

    document.getElementById("loginButton").addEventListener("click", function() {
      login();
    });

    // Define an array of tags
    var tags = ["Fruits", "Coding", "BMW", "Python"];

    // Function to generate and populate tags
    function populateTags() {
      var tagsContainer = document.getElementById("tags");
      tagsContainer.innerHTML = ""; // Clear existing tags

      // Iterate through the tags array and create tags dynamically
      for (var i = 0; i < tags.length; i++) {
        var tag = document.createElement("span");
        tag.className = "tag";
        tag.textContent = tags[i];
        tag.addEventListener("click", function() {
          var query = this.textContent;
          document.getElementById("test").getElementsByTagName("input")[0].value = query;
          searchFromFile(query);
        });
        tagsContainer.appendChild(tag);
      }
    }

    // Call the populateTags function to display the initial tags
    populateTags();

    function save() {
      var query = document.getElementById("test").getElementsByTagName("input")[0].value;
      var results = document.getElementById("searchResults").innerHTML;

      document.getElementById("queryInput").value = query;
      document.getElementById("resultsInput").value = results;

      document.getElementById("searchform").submit();
    }

    function login() {
      alert("User login functionality is not implemented yet.");
    }
  </script>
</body>
</html>
