<!DOCTYPE html>
<html>
<head>
  <style>
    /* CSS styles */

    body {
      display: flex;
      justify-content: center;
      align-items: center;
      height: 100vh;
    }

    #headerContainer {
      text-align: center;
      margin-bottom: 20px; /* Add margin-bottom to create space below the welcome message */
    }
    
    #test {
      position: relative;
      width: 500px;
      height: 50px;
      font-size: 20px;
      padding: 10px 60px 10px 10px;
      border-radius: 25px;
      border: 2px solid #333; /* Set the border color to dark */
    }

    #test input[type="search"] {
      width: 100%;
      height: 100%;
      padding: 0;
      border: none;
      outline: none;
      background: transparent;
    }

    #test .mic-icon,
    #test .scanner-icon {
      position: absolute;
      top: 50%;
      transform: translateY(-50%);
      cursor: pointer;
    }

    #test .mic-icon {
      right: 38px;
      background-image: url('/static/mic.png');
      width: 24px;
      height: 24px;
      background-repeat: no-repeat;
      background-size: 100% 100%;
    }

    #test .scanner-icon {
      right: 10px;
      background-image: url('/static/scannerr.png');
      width: 24px;
      height: 24px;
      background-repeat: no-repeat;
      background-size: 100% 100%;
    }

    #test::-webkit-search-cancel-button,
    #test::-webkit-search-decoration,
    #test::-webkit-search-results-button,
    #test::-webkit-search-results-decoration {
      display: none; 
    }

    .search-bar-container {
      position: relative; 
      display: inline-block; 
    }

    input[type="submit"] {
      font-size: 24px;
      padding: 12px 24px;
      border-radius: 25px;
      border: 2px solid #ccc;
      background-color: black;
      color: white;
      cursor: pointer;
    }

    .search-bar-buttons-container {
      display: inline-block;
    }

    .search-button-container {
      display: inline-block;
      margin-left: 5px;
      vertical-align: top;
    }

    #saveButton {
      font-size: 24px;
      padding: 12px 24px;
      border-radius: 25px;
      border: 2px solid #ccc;
      background-color: blue;
      color: white;
      cursor: pointer;
    }

    #removeButton {
      font-size: 24px;
      padding: 12px 24px;
      border-radius: 25px;
      border: 2px solid #ccc;
      background-color: grey;
      color: white;
      cursor: pointer;
    }

    #resetButton {
      font-size: 24px;
      padding: 12px 24px;
      border-radius: 25px;
      border: 2px solid #ccc;
      background-color: green;
      color: white;
      cursor: pointer;
    }

    #searchResults {
      display: inline-block;
      margin: 0;
      font-size: 24px;
    }

    #test.move-up {
      transform: translateY(-100%);
    }
  </style>
</head>
<body>
    <form id="searchform" class="search2" method="post" action="/save_search">
      <div class="search-bar-buttons-container">
        <div class="search-bar-container">
          <div id="test">
            <input class="search2" type="search" name="search" size="30" maxlength="255">
            <div class="mic-icon"></div>
            <div class="scanner-icon"></div>
          </div>
        </div>
        <div id="profileIconContainer"></div>
      </div>
      <div class="search-button-container">
        <input type="submit" value="Search">
      </div>
      <div class="search-button-container">
        <input id="saveButton" type="button" value="Save">
      </div>
      <div class="search-button-container">
        <input id="removeButton" type="button" value="Remove">
      </div>
      <div class="search-button-container">
        <input id="resetButton" type="button" value="Reset">
      </div>
      <input type="hidden" id="resultsInput" name="results" value="">
      <input type="hidden" name="query" id="queryInput">
      <input type="hidden" name="results" id="resultsInput">
    </form>
    
    <div id="searchResults"></div>

    <script>
      function handleMicClick() {
        // Prompt the user to speak
        var recognition = new (window.SpeechRecognition || window.webkitSpeechRecognition || window.mozSpeechRecognition || window.msSpeechRecognition)();
        recognition.lang = "en-US";
        recognition.interimResults = false;
        recognition.maxAlternatives = 1;

        recognition.start();

        recognition.onresult = function(event) {
          var query = event.results[0][0].transcript;
          document.getElementById("test").getElementsByTagName("input")[0].value = query;
          document.getElementById("searchform").submit(); // Submit the search form
        };
      }

      function handleScannerClick() {
        var input = document.createElement("input");
        input.type = "file";
        input.accept = "image/*";
        input.style.display = "none";

        // Trigger click event on the file input element
        input.click();

        // Handle file selection
        input.onchange = function(event) {
          var file = event.target.files[0];

          // Handle the uploaded file here (e.g., send it to the server)
          console.log("Uploaded file:", file);
        };
      }

      document.getElementById("searchform").addEventListener("submit", function(event) {
        event.preventDefault();

        var query = document.getElementsByName("search")[0].value;

        // Send the search query to the server
        fetch("/search", {
          method: "POST",
          body: new URLSearchParams({
            "search": query
          })
        })
          .then(function(response) {
            return response.text();
          })
          .then(function(results) {
            displayResults(results);
          })
          .catch(function(error) {
            console.error(error);
          });
      });

      function moveSearchBarUp() {
        var searchBar = document.getElementById("test");
        searchBar.classList.add("move-up");
      }

      function displayResults(results) {
        var resultsContainer = document.getElementById("searchResults");
        resultsContainer.innerHTML = ""; // Clear existing results

        var resultsArray = results.split(",");
        for (var i = 0; i < resultsArray.length; i++) {
          var result = resultsArray[i].trim();
          var resultElement = document.createElement("div");
          resultElement.innerText = result; // Use innerText instead of textContent
          resultsContainer.appendChild(resultElement);
        }
      }

      document.querySelector(".mic-icon").addEventListener("click", function() {
        handleMicClick();
      });

      document.querySelector(".scanner-icon").addEventListener("click", function() {
        handleScannerClick();
      });

      document.getElementById("saveButton").addEventListener("click", function() {
        save();
      });

      document.getElementById("loginButton").addEventListener("click", function() {
        login();
      });

      document.getElementById("removeButton").addEventListener("click", function() {
        remove();
      });

      function save() {
        var query = document.getElementById("test").getElementsByTagName("input")[0].value;
        var results = document.getElementById("searchResults").innerHTML;

        document.getElementById("queryInput").value = query;
        document.getElementById("resultsInput").value = results;

        document.getElementById("searchform").submit();
      }

      function remove() {
        var query = document.getElementById("test").getElementsByTagName("input")[0].value;

        document.getElementById("queryInput").value = query;

        fetch("/remove", {
          method: "POST",
          body: new URLSearchParams({
            "query": query
          })
        })
          .then(function(response) {
            return response.text();
          })
          .then(function() {
            // Handle success if needed
          })
          .catch(function(error) {
            console.error(error);
          });
      }
    </script>
  </body>
</html>
